// Generated by CoffeeScript 1.8.0
var MessageHandler;

MessageHandler = (function() {
  MessageHandler.prototype.lastMessage = null;

  function MessageHandler(conn) {
    this.conn = conn;
  }

  MessageHandler.prototype.broadcast = function(type, data, connections) {
    var senderId;
    if (JSON.stringify(data) === JSON.stringify(this.lastMessage)) {
      return;
    }
    this.lastMessage = data;
    senderId = this.conn.getId();
    return connections.forEach(function(conn) {
      var id;
      id = conn.getId();
      if (senderId !== id) {
        return conn.send(JSON.stringify(data));
      }
    });
  };

  MessageHandler.prototype.handle = function(data, connections) {
    var _ref;
    if ((_ref = data.type) === 'open' || _ref === 'close' || _ref === 'save' || _ref === 'cursor') {
      return this.broadcast(data.type, data, connections);
    }
  };

  return MessageHandler;

})();

module.exports = MessageHandler;
